<!DOCTYPE html>
<html lang="en" class="h-100">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  ${HTML_HEAD_TOP}

  <title>${LOC:html.settings.manage_app} | Mc-Auth.com</title>

  ${HTML_HEAD_BOTTOM}
</head>

<body class="d-flex flex-column h-100">
  ${HTML_HEADER}

  <script>
    function startAppIconUpload(elem) {
      const input = document.createElement('input');
      input.type = 'file';

      input.onchange = async (e) => {
        const file = e.target.files[0];

        if (file) {
          const res = await fetch(`${BASE_URL}/uploads/new`, {
            method: 'POST',
            headers: { 'Content-Type': file.type },
            body: file
          });

          const json = await res.json();

          if (res.status === 201) {
            console.log(`Stored at ` + res.headers.get('Location'));

            document.getElementById('icon').value = json.id;
            elem.src = res.headers.get('Location');

            console.log('Upload succeeded:', json);
          } else {
            console.error('Upload failed:', json);
          }
        }
      };

      input.click();
    }
  </script>

  <main style="margin-bottom: 2rem">
    <div class="container">
      <div class="card centeredCard" style="max-width: unset; min-width: 40vw;">
        <div class="card-header">
          <h5 class="text-center">${LOC:html.settings.manage_app}</h5>
        </div>

        <div class="card-body">
          <div class="row">
            <div class="col">
              <p class="text-muted">${APP_ID}</p>
            </div>

            <div class="col">
              <p class="text-muted text-unrevealed" onclick="reveal(this, '${APP_SECRET}')">
                ${LOC:html.settings.click_to_show}</p>
            </div>
          </div>

          <hr>

          <p class="text-center">
            ${LOC:html.settings.please_provide_exact_info}
            <br>
            ${LOC:html.settings.you_can_edit_at_any_time}
          </p>

          <form method="POST">
            <input type="text" class="hidden" name="client_id" value="${APP_ID}" required>

            <div>
              <img src="${APP_ICON}" onclick="startAppIconUpload(this)" class="rounded mx-auto d-block"
                style="max-height: 128px; max-width: 128px;" alt="${LOC:html.authorize.app_logo}">
              <input type="text" class="form-control hidden" id="icon" name="icon" value="${APP_ICON_ID}" required>
              <p class="text-muted text-center">${LOC:html.settings.click_image_above_to_upload}</p>
            </div>

            <div class="form-group">
              <label for="name">${LOC:words.name}<span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="name" name="name" value="${APP_NAME}" maxlength="128"
                data-remaining="nameRemain" oninput="updateRemainingChars(this)" required>
              <small id="nameRemain" class="form-text text-muted">${LOC:html.settings.max_length_128_characters}</small>
            </div>

            <div class="form-group">
              <label for="desc">${LOC:words.description}</label>
              <textarea rows="3" class="form-control" id="desc" name="desc" maxlength="512" data-remaining="descRemain"
                oninput="updateRemainingChars(this)">${APP_DESCRIPTION_RAW}</textarea>
              <small id="descRemain" class="form-text text-muted">${LOC:html.settings.max_length_512_characters}</small>
            </div>

            <div class="form-group">
              <label for="redirect_uris">${LOC:html.settings.redirect_uris}</label>
              <textarea rows="3" class="form-control" id="redirect_uris"
                name="redirect_uris">${APP_REDIRECT_URIs}</textarea>
            </div>

            <hr>

            <div class="row">
              <div class="col" style="padding-right: 6px">
                <a class="btn btn-danger float-right" href="${URL_BASE}/settings"
                  role="button">${LOC:html.settings.return_to_settings}</a>
              </div>

              <div class="col" style="padding-left: 6px">
                <button type="submit" class="btn btn-success">${LOC:words.save_changes}</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </main>

  ${HTML_FOOTER}
</body>

</html>